# ePay.bg ONE TOUCH API Документация
*Версия: 2025-02-08*

> **Забележка**: Това е архивирана версия на API документацията. За най-новата версия, моля посетете [официалната API документация на ePay.bg](https://www.epay.bg/v3main/front?p=api#api_start).

## Съдържание
- [Описание](#описание)
- [Комуникация](#комуникация)
- [Оторизация и управление на токени](#оторизация-и-управление-на-токени)
- [Информация за потребител и платежни инструменти](#информация-за-потребител-и-платежни-инструменти)
- [Изпращане на пари](#изпращане-на-пари)
- [Плащане от нерегистриран потребител](#плащане-от-нерегистриран-потребител)

## Описание

ePay.bg ONE TOUCH е интерфейс за комуникация със сървърите на ePay.bg. За да го използвате, трябва да имате регистрирано приложение, което потребителите на ePay.bg оторизират да извършва определени действия. Всяко приложение има:

- Таен ключ (`SECRET`)
- Адрес за отговор (`REPLY_ADDRESS`) - адрес на страницата ви или URL схема на мобилното приложение
- Уникален идентификатор (`APPID`), който изпращате с всяка заявка

## Комуникация

### API Адреси
**Тестова среда:**
- Основен API: `https://demo.epay.bg/xdev/api`
- Уеб API: `https://demo.epay.bg/xdev/mobile`

### Валидация на заявките
- Параметър: `APPCHECK`
- Алгоритъм: `hmac_sha1_hex(request_data, SECRET)`
- Формат: Параметри, конкатенирани с NEWLINE, сортирани по име
- Заявки с токен: Добавяне на клиентски номер + NEWLINE

### Формат на отговорите
```json
// Успех
{
    \"status\": \"OK\",
    // Допълнителни данни според заявката
}

// Грешка
{
    \"status\": \"ERR\",
    \"err\": \"КОД_НА_ГРЕШКА\",
    \"errm\": \"Съобщение за потребителя\"
}
```

## Оторизация и управление на токени

### Задължителни параметри
- `APPID`: Идентификатор на приложението
- `DEVICEID`: Уникален идентификатор на устройството
- `TOKEN`: Токен за оторизация на потребителя

### Получаване на токен

1. **Заявка за оторизация**
   ```
   GET API_BASE_WEB/api/start
   Параметри:
   - DEVICEID (задължителен)
   - APPID (задължителен)
   - KEY (задължителен)
   - DEVICE_NAME (препоръчителен)
   - BRAND (препоръчителен)
   - OS (препоръчителен)
   - MODEL (препоръчителен)
   - OS_VERSION (препоръчителен)
   - PHONE (препоръчителен)
   - UTYPE (1=регистрирани потребители, 2=нерегистрирани потребители)
   ```

2. **Получаване на код за токен**
   ```
   GET API_BASE/api/code/get
   Параметри:
   - DEVICEID (задължителен)
   - APPID (задължителен)
   - KEY (задължителен)
   ```

3. **Получаване на токен**
   ```
   GET API_BASE/api/token/get
   Параметри:
   - DEVICEID (задължителен)
   - APPID (задължителен)
   - CODE (задължителен)
   ```

### Инвалидиране на токен
```
GET API_BASE/api/token/invalidate
Параметри:
- APPID (задължителен)
- DEVICEID (задължителен)
- TOKEN (задължителен)
```

## Обработка на плащания

### Инициализация на плащане
```
POST API_BASE/payment/init
Параметри:
- TYPE=\"send\" (задължителен)
- EXP=Unix Time (опционален, валидност на ID на плащането)
```

### Опции за видимост на плащането
```json
{
    \"payment\": {
        \"SHOW.NAME\": Integer,
        \"SHOW.KIN\": Integer,
        \"SHOW.GSM\": Integer,
        \"SHOW.EMAIL\": Integer
    }
}
```

### Допълнителни параметри
- `SAVECARD`: Стойност 1 за запазване на картата за бъдещи плащания
- `APPCHECK`: Чексума за валидация на заявката

## Важни забележки
- Всички заявки трябва да включват `APPID`, `DEVICEID` и `TOKEN` (след оторизация)
- Кодовете за токен изтичат след 2 минути
- За мобилни приложения използвайте Vendor ID (iOS) или ANDROID_ID (Android) като `DEVICEID`
- Свържете се с Търговския отдел на ePay.bg за регистрация на приложението
